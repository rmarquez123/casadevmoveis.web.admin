<!-- src\app\productslist.component.html -->


<div class="products-container">
  <div class="sidebar">
    <button (click)="onCreateNew()">Produtos</button>
    <button>Redes Sociais</button>
    <button>Configurações</button>
  </div>

  <div class="main-content">
    <h1>Casa De Móveis Usados</h1>

    <!-- Category filter -->
    <div class="controls-container">

      <!-- Filters dropdown -->
      <div class="filters">
        <button class="filters-btn" type="button" (click)="toggleFilters()">
          Filtros
          <span class="pill" *ngIf="getActiveFilterCount() > 0">{{ getActiveFilterCount() }}</span>
          <span class="chev" [class.open]="filtersOpen">▾</span>
        </button>

        <div class="filters-panel" *ngIf="filtersOpen">
          <div class="filters-grid">

            <div class="field">
              <label for="name-filter">Nome</label>
              <input id="name-filter" type="text" [(ngModel)]="filterName" placeholder="Buscar por nome..." />
            </div>

            <div class="field">
              <label for="id-filter">Código</label>
              <input id="id-filter" type="number" [(ngModel)]="filterId" placeholder="Ex: 12" min="0" />
            </div>

            <div class="field">
              <label for="available-filter">Disponível</label>
              <select id="available-filter" [(ngModel)]="filterAvailable">
                <option [ngValue]="null">Todos</option>
                <option [ngValue]="true">Sim</option>
                <option [ngValue]="false">Não</option>
              </select>
            </div>

            <div class="field">
              <label for="site-visible-filter">Site</label>
              <select id="site-visible-filter" [(ngModel)]="filterSiteVisible">
                <option [ngValue]="null">Todos</option>
                <option [ngValue]="true">Visível</option>
                <option [ngValue]="false">Oculto</option>
              </select>
            </div>

            <div class="field field-wide">
              <label for="category-filter">Categoria</label>
              <select id="category-filter" [(ngModel)]="selectedCategoryId">
                <option [ngValue]="null">Todas as Categorias</option>
                <option *ngFor="let category of categories" [ngValue]="category.categoryId">
                  {{ category.name }}
                </option>
              </select>
            </div>

          </div>

          <div class="filters-actions">
            <button class="secondary-btn" type="button" (click)="clearFilters()">Limpar</button>
            <button class="primary-btn" type="button" (click)="filterProducts(); closeFilters()">Aplicar</button>
          </div>
        </div>
      </div>

      <!-- <div class="view-toggle">
        <button class="create-btn" (click)="toggleView()">Mudar Para {{ isGridView ? 'Table' : 'Grid' }} View</button>
      </div> -->

      <div class="button-container">
        <button class="create-btn" (click)="onCreateNew()">[+] Adicionar Novo Produto</button>
      </div>

    </div>



    <!-- Conditionally render either the table or grid -->
    <table *ngIf="!isGridView">
      <thead>
        <tr>
          <th>Codigo</th>
          <th>Item</th>
          <th>Categoria</th>
          <th>Fotos</th>
          <th>Preco</th>
          <th>Data de Recebimento</th>
          <th>Disponível</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts" (dblclick)="onEdit(product)">
          <td>{{ formatCode(product.id) }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.categoryName }}</td>
          <td>
            <div class="photo-thumbnails">
              <img *ngFor="let photo of photos[product.id] || []" [src]="'data:image/jpeg;base64,' + photo.src"
                alt="Photo" class="thumbnail" />
            </div>
          </td>
          <td>{{ formatPrice(product.price)}}</td>
          <td>{{ product.dateReceived | date }}</td>
          <td>{{ product.available ? 'Sim' : 'Não' }}</td>
          <td>
            <button (click)="onEdit(product)" [disabled]="removing[product.id!]">
              Editar
            </button>
            <button (click)="onRemove(product)" [disabled]="removing[product.id!]">
              Remover
            </button>
          </td>

        </tr>
      </tbody>
    </table>

    <div class="grid" *ngIf="isGridView">
      <div class="grid-item" *ngFor="let product of filteredProducts" (dblclick)="onEdit(product)">
        <h3>{{ product.name }}</h3>
        <p>Categoria: {{ product.categoryName }}</p>
        <div class="photo-thumbnails">
          <img *ngFor="let photo of photos[product.id] || []" [src]="'data:image/jpeg;base64,' + photo.src" alt="Photo"
            class="thumbnail" />
        </div>
        <p>Preco: {{ formatPrice(product.price)}}</p>
        <p>Data: {{ product.dateReceived | date }}</p>
        <p>Disponível: {{ product.available ? 'Sim' : 'Não' }}</p>
        <div>
          <button (click)="onEdit(product)" [disabled]="removing[product.id!]">
            Editar
          </button>
          <button (click)="onRemove(product)" [disabled]="removing[product.id!]">
            Remover
          </button>
        </div>
      </div>
    </div>

    <!-- Confirm removal dialog -->
    <div class="dialog-backdrop" *ngIf="confirmRemoveProduct">
      <div class="dialog">
        <h2>Confirmar remoção</h2>
        <p>
          Tem certeza que deseja remover o produto
          "<strong>{{ confirmRemoveProduct.name }}</strong>"?
        </p>

        <div class="dialog-actions">
          <button (click)="confirmRemove()" [disabled]="removing[confirmRemoveProduct.id!]">
            {{ removing[confirmRemoveProduct.id!] ? 'Removendo...' : 'Remover' }}
          </button>

          <button class="secondary" (click)="cancelRemove()" [disabled]="removing[confirmRemoveProduct.id!]">
            Cancelar
          </button>
        </div>
      </div>
    </div>

  </div>

</div>